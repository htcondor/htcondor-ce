
###############################################################################
#
# HTCondor-CE server authorization configuration
#
# DO NOT EDIT THIS FILE!  It will be overwritten upon RPM upgrade.
# If you wish to make changes to the HTCondor-CE configuration, create files
# in /etc/condor-ce/config.d containing your changes.
#
###############################################################################

# These should be unnecessary, unless if we have an error below.
DENY_WRITE = anonymous@*, *@unmapped, *@banned.htcondor.org
DENY_NEGOTIATOR = anonymous@*, *@unmapped
DENY_ADMINISTRATOR = anonymous@*, *@unmapped
DENY_DAEMON = anonymous@*, *@unmapped

# Defaults authorizations
SUPERUSERS = condor@daemon.htcondor.org/$(FULL_HOSTNAME), root@daemon.htcondor.org/$(FULL_HOSTNAME)
FRIENDLY_DAEMONS = condor@daemon.htcondor.org/$(FULL_HOSTNAME) condor@child/$(FULL_HOSTNAME)
# Setting the UID_DOMAIN appends @users.htcondor.org to GUMS mappings.
UID_DOMAIN = users.htcondor.org
USERS = *@users.htcondor.org

# Unmapped users who authenticated with SSL; they are allowed to advertise
# to the collector, but that is all.
UNMAPPED_USERS = ssl@unmapped

# Authz settings for each daemon.  Preferably, change the templates above
ALLOW_READ = *
ALLOW_WRITE = $(FRIENDLY_DAEMONS)
SCHEDD.ALLOW_WRITE = $(USERS), condor@daemon.htcondor.org/$(FULL_HOSTNAME)
COLLECTOR.ALLOW_ADVERTISE_MASTER = $(FRIENDLY_DAEMONS)
COLLECTOR.ALLOW_ADVERTISE_SCHEDD = $(FRIENDLY_DAEMONS)
COLLECTOR.ALLOW_ADVERTISE_STARTD =  $(UNMAPPED_USERS), $(USERS)
SCHEDD.ALLOW_NEGOTIATOR = condor@daemon.htcondor.org/$(FULL_HOSTNAME)
ALLOW_DAEMON = $(FRIENDLY_DAEMONS)
C_GAHP.ALLOW_DAEMON = $(ALLOW_DAEMON)
ALLOW_ADMINISTRATOR = $(SUPERUSERS)
QUEUE_SUPER_USERS = $(SUPERUSERS)

# This security setting is likely unnecessary as we don't run a negotiator.
# However, we'd prefer to see the least number of authorizations possible.
ALLOW_NEGOTIATOR = $(SUPERUSERS)

# Authentication settings
SEC_DEFAULT_AUTHENTICATION_METHODS = FS
SEC_CLIENT_AUTHENTICATION_METHODS = FS, TOKEN, SCITOKENS, SSL
SCHEDD.SEC_WRITE_AUTHENTICATION_METHODS = FS,TOKEN,SCITOKENS,SSL
SCHEDD.SEC_READ_AUTHENTICATION_METHODS = FS,TOKEN,SCITOKENS,SSL
COLLECTOR.SEC_READ_AUTHENTICATION_METHODS = FS,TOKEN,SCITOKENS,SSL
COLLECTOR.SEC_WRITE_AUTHENTICATION_METHODS = FS,TOKEN,SCITOKENS,SSL
COLLECTOR.SEC_ADVERTISE_STARTD_AUTHENTICATION_METHODS = FS,TOKEN,SCITOKENS,SSL

# SciTokens settings
SCITOKENS_SERVER_AUDIENCE=$(COLLECTOR_HOST)

# CE configuration which allows READ-level TOKEN authorizations to be
# generated by the remote CE collector.
SEC_ENABLE_IMPERSONATION_TOKENS=true
SEC_IMPERSONATION_TOKEN_LIMITS=READ

# Enable the audit log for the CE's activities
SCHEDD_AUDIT_LOG = $(LOG)/AuditLog
SCHEDD_DEBUG = D_AUDIT
MAX_SCHEDD_AUDIT_LOG = 1d
MAX_NUM_SCHEDD_AUDIT_LOG = 90

# Require regular expressions in the second field of the HTCondor mapfile
# to start and end with '/'
CERTIFICATE_MAPFILE_ASSUME_HASH_KEYS = True
